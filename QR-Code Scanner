import qrcode
from PIL import Image

import cv2
from pyzbar.pyzbar import decode


#--QR-Code with Camara scannen
def liveScanner():
        cap = cv2.VideoCapture(0) # opens the camera
        print("Start Camera... press Q to quit")

        while True: # Endless loop to read live camera images
            ret, frame = cap.read() # Read camera image (ret = success)
            if not ret: # if no image was read, abort
                print("Camera is closed")
                break

            decoded_objs = decode(frame)
            for obj in decoded_objs: # Search for QR code in the current image
                points = obj.polygon # Key points of the code
                pts = [(point.x, point.y) for point in points] # Draws lines between the points
                pts = pts + [pts[0]] 
                for i in range(len(pts)-1):
                    cv2.line(frame, pts[i], pts[i+1], (255,0,0), 2)

                qr_text = obj.data.decode("utf-8")
                cv2.putText(frame, qr_text, (pts[0][0], pts[0][1] -10),
                            cv2.FONT_HERSHEY_SIMPLEX, 0.7, (255,0,0), 2) # Extracts the QR code text and writes it on the image
                print("QR-Code: ", qr_text) # shows the live image with markings
            cv2.imshow("QR-Code Live Scanner", frame)

            if cv2.waitKey(1) & 0xFF == ord('q'):# if you press Q, cancel
                break

#--Hauptprogramm--
if __name__ == "__main__":

    #Live QR-Code Scanner start
    liveScanner()
